{% extends "menu.html" %} {% load i18n %} {% block title %}{% trans "Cases Study" %}{% endblock %} {% load i18n %} {% load static from staticfiles %} {% load bootstrap_tags %}
<h1>{% trans "Cases Study" %}</h1>

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
<link rel="stylesheet" href="http://xguaita.github.io/Leaflet.MapCenterCoord/dist/L.Control.MapCenterCoord.min.css" />
<link rel="stylesheet" href="https://photon.komoot.io/static/leaflet.photon/leaflet.photon.css">
</link>

<script>
    var intakePolygons = [];
    SEARCH_CITY_API_URL = '{{ SEARCH_CITY_API_URL }}';
    SEARCH_COUNTRY_API_URL = '{{ SEARCH_COUNTRY_API_URL }}';
</script>

{% endblock %} {% block body_outer %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}waterproof_nbs_ca/css/dataTables.bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}study_cases/css/study_cases.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
<div class="header-waterproof">
    <div>
        <h1>{% trans "list_study_case" %}</h1>
    </div>
    <div class="row">
        <div class="col-md-4">
            <h4 class="text-center" id="countryLabel"></h4>
            <p><b>{% trans "Selected City" %} :</b> <span id="cityLabel">{{city}}</span></p>
            <p><b>{% trans "Region" %} :</b> <span id="regionLabel">{{region.name}}</span></p>
            <p><b>{% trans "Currency" %}:</b><span id="currencyLabel">({{currency.code}}) - {{currency.name}}</span></p>
            <div>
                {% if user.is_authenticated and not READ_ONLY_MODE %}
                <a href="create/" id="createUrl" textColor="red" style="outline-color: dimgrey;">{% trans "new_study_case" %}</a>
                {% else %}
                <a id="createUrlDisabled">{% trans "new_study_case" %}</a>
                <h6>{% trans "You must be a registered user to create a new Case Study*" %}</h6>
                {% endif %}
        
            </div>
        </div>
        <div class="col-md-8">
            <div id="mapidcuenca"></div>
        </div>
    </div>
</div>
<div class="table-responsive">
    <table id="studycases" class="table table-striped table-bordered table-condensed" style="width:100%">
        <thead>
            <tr class="info">
                <th scope="col" class="small text-center vat">{% trans "Name" %}</th>
                <th scope="col" class="small text-center vat px-5">{% trans "Description" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Status" %}</th>
                <th scope="col" class="small text-center vat">{% trans "User" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Date" %}</th>
                <th scope="col" class="small text-center vat">{% trans "City" %}</th>
                <th scope="col" class="small text-center vat">{% trans "treatment_plants" %}</th>
                <th scope="col" class="small text-center vat">{% trans "water_intakes" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Currency" %}</th>
                <th scope="col" class="small text-center vat">{% trans "execution_status" %}</th>
                <th scope="col" class="small text-center vat">{% trans "Actions" %}</th>

            </tr>
        </thead>
        <tbody>
            {% for studyCases in casesList %}
            <tr>
                <td class="small text-center vat">{{studyCases.name}}</td>
                <td class="small text-center vat">{{studyCases.description}}</td>
                {% if studyCases.is_complete%}
                <td class="small text-center vat"><i class="glyphicon glyphicon-ok-circle fa-lg text-success" title='{% trans "Completed" %}'></i></td>
                {% else %}
                <td class="small text-center vat"><i class="glyphicon glyphicon-hourglass fa-lg text-warning" title='{% trans "In Progress" %}'></i></td>
                {% endif %}
                <td class="small text-center vat">{{studyCases.added_by}}</td>
                <td class="small text-center vat">{{studyCases.create_date | date:"d-m-Y"}}</td>
                <td class="small text-center vat">{{studyCases.city}}</td>
                <td class="small text-center vat">
                    {% if studyCases.studycase_type == "PTAP" %}
                    {% for ptap in studyCases.ptaps.all %}
                    <a onclick='viewPtap({{ptap.id}})'>- {{ptap.plant_name}} </a><br>
                    {% endfor %}</td>
                {% else %}
                {% trans "N/A" %}<br>{% trans "Custom case" %}
                {% endif %}

                <td class="small text-center vat">{% for intake in studyCases.intakes.all %}
                    <a href="../intake/view/{{intake.id}}" target="_blank">- {{intake.name}} </a> <br>
                    {% endfor %}</td>
                <td class="small text-center vat"><a onclick='viewCurrencys({{studyCases.id}})'>{{studyCases.analysis_currency}}</a></td>
                {% if studyCases.is_run_analysis%}
                <td class="small text-center vat"><i class="glyphicon glyphicon-play-circle fa-lg text-success" title='{% trans "Completed" %}'></i></td>
                {% else %}
                <td class="small text-center vat"><i class="glyphicon glyphicon-stop fa-lg text-danger" title='{% trans "In Progress" %}'></i></td>
                {% endif %}


                <td class="small text-center vat">
                    <div class="btn-group btn-group-table" role="group"></div>
                    <a class="btn btn-primary" href="view/{{studyCases.pk}}"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></a>
        </div>
{% if user.is_authenticated %}
{% if user.professional_role == 'ADMIN' %}
<a class="btn btn-info" href="edit/{{studyCases.pk}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
<a class="btn btn-warning" href="clone/{{studyCases.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
<a class="btn btn-danger" data-id="{{studyCases.pk}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a>
<a class="btn btn-info" href="report/{{studyCases.pk}}"><span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>{% endif %}
{% if user.professional_role == 'ANALYS' or user.professional_role == 'COPART' or user.professional_role == 'ACDMC' or user.professional_role == 'SCADM' or user.professional_role == 'MCOMC' or user.professional_role == 'CITIZN' or user.professional_role == 'REPECS' or user.professional_role == 'OTHER' %}
{% if studyCases.added_by.pk == user.pk %}
<a class="btn btn-info" href="edit/{{studyCases.pk}}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
<a class="btn btn-warning" href="clone/{{studyCases.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
<a class="btn btn-danger" data-id="{{studyCases.pk}}"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a> 
<a class="btn btn-info" href="report/{{studyCases.pk}}"><span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>{% else %}
<a class="btn btn-warning" href="clone/{{studyCases.pk}}"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></a>
{% endif %}
{% endif %}
{% endif %}

</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

{% block body %}{% endblock body %} {% block sidebar %}{% endblock sidebar %} {% endblock body_outer %} {% block extra_script %}
<script>
    var countriesLayerUrl = '{{ STATIC_URL }}waterproof_intake/data/countries.geojson';
    var userCountryId = '{{userCountry.id}}';
    var userCountryCode = '{{userCountry.code}}';
    var userCountryName = '{{userCountry.name}}';
</script>
<script src="{{ STATIC_URL }}geonode/js/datatables/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}geonode/js/datatables/dataTables.bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet.ajax.min.js"></script>
<script src="{{ STATIC_URL }}study_cases/js/study_cases_list.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
<script src="https://vinceg.github.io/twitter-bootstrap-wizard/prettify.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/photon/leaflet.photon.js"></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/Leaflet.Coordinates.js " %}"></script>
<script src="{{ STATIC_URL }}geonode/js/leaflet/leaflet-omnivore.min.js"></script>

<script src="{{ STATIC_URL }}geonode/sample_data/intake_polygon.js"></script>
<script src=" https://cdn.jsdelivr.net/npm/sweetalert2@10 "></script>
<script type="text/javascript">
    API_URL = '/proxy/?url=https://photon.komoot.de/api/?';
    TILELAYER = 'http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    CENTER = [-74.4879, 4.582];
    MAXZOOM = 11;

    let waterproof = {};

    $(document).ready(function() {



    });

    var searchPoints = L.geoJson(null, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.name);
        }
    });
</script>
{% endblock %}